generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums to define possible statuses
enum ScheduleStatus {
  PENDING       // Schedule is planned but not started
  IN_PROGRESS   // Schedule is currently being executed
  COMPLETED     // All sub-tasks are done or the schedule is finished
  CANCELLED     // Schedule was planned but abandoned
}

enum SubTaskStatus {
  PENDING       // Sub-task is planned but not started
  IN_PROGRESS   // Sub-task is currently being worked on
  COMPLETED     // Sub-task is finished
  SKIPPED       // Sub-task was intentionally skipped
  PAUSED        // Optional: if you want to track pauses
}

// Role model
model Role {
  id       Int     @id @default(autoincrement())
  name     String  @unique
  persons  Person[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Category model
model Category {
  id       Int     @id @default(autoincrement())
  name     String  @unique
  persons  Person[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Person model
model Person {
  id           String   @id @default(uuid())
  name         String
  username     String   @unique
  passwordHash String
  phoneNo      String   @unique
  email        String   @unique
  roleId       Int
  role         Role     @relation(fields: [roleId], references: [id])
  categoryId   Int
  category     Category @relation(fields: [categoryId], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  schedules    Schedule[]
}

// Schedule model
model Schedule {
  id                   String        @id @default(uuid())
  title                String
  description          String?
  totalDurationSeconds Int

  // NEW STATUS FIELDS FOR SCHEDULE
  status               ScheduleStatus @default(PENDING) // Overall status of the schedule
  actualStartTime      DateTime?      // When the schedule actually started (nullable)
  actualEndTime        DateTime?      // When the schedule actually finished (nullable)

  personId             String
  person               Person        @relation(fields: [personId], references: [id])

  subTasks             SubTask[]

  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
}

// SubTask model
model SubTask {
  id              String        @id @default(uuid())
  name            String
  durationSeconds Int

  // NEW STATUS FIELDS FOR SUBTASK
  status          SubTaskStatus @default(PENDING) // Status of this specific sub-task
  actualStartTime DateTime?     // When this sub-task actually started (nullable)
  actualEndTime   DateTime?     // When this sub-task actually finished (nullable)
  actualDurationSeconds Int?    // Calculated actual duration (nullable)
  notes           String?       // Optional: For user notes like "finished early/late"

  scheduleId      String
  schedule        Schedule      @relation(fields: [scheduleId], references: [id])

  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}
